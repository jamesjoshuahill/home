#!/usr/bin/env bash

set -euo pipefail

main() {
  start

  update_macos
  install_homebrew
  install_homebrew_bundle
  run_post_install_scripts

  finish
}

log() {
  local message=$1
  echo -e "\033[1m--> ${message}\033[0m"
}

start() {
  log "Start setup"
}

update_macos() {
  log "Update macOS"
  softwareupdate --install --all
}

install_homebrew() {
  log "Install Homebrew"
  if hash brew &> /dev/null
  then
    echo "Homebrew already installed."
    return
  fi

  yes '' | ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
}

install_homebrew_bundle() {
  log "Install Homebrew Bundle"
  brew bundle --global --verbose
}

run_post_install_scripts() {
  for installer in "$HOME/.config/post_install"/*.bash
  do
    command "$installer"
  done
}

finish() {
  log "Finished setup"
  echo
}

main
